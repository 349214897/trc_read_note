# 停车位评测初版
## 评测指标选择原则
- 能够在各个维度全面的评估模型的性能
## **评测数据**
- **初版**旨在供rd**确定模型效果**,指导接下来的优化
- 同时为未来QA的评测理清流程和确定量化指标
- 考虑到迅速迭代和评测数据的获取难度,选择在**图像坐标系下**评测,在**当前标注数据**中**选取**一部分大概10%作为评测数据集
## 评测环境
- 初版主要关注模型效果,对上车环境(内存占用率,显存占用率,gpu使用率)不是主要关注点,所以主要利用**python脚本运行模型得到结果**
## **评测指标**(分成两个场景,五个维度)
### 1.巡航(侧向)
- **停车位**准确率,召回率
\[
precision=\frac{TP}{TP+FP}
\]
\[
recall=\frac{TP}{TG}
\]
  - TP,预测准确的空停车位(**与label相比,有三个点匹配上**)
  - FP,预测错误的空停车位
  - TG,标注的总的空车位
- **停车角点**准确率,召回率
\[
precision=\frac{TP}{TP+FP}
\]
\[
recall=\frac{TP}{TG}
\]
  - TP,预测准确的空停车角点(**与label相比,距离在\[
    scale*stand\_thresh
    \]范围内的点,scale与停车位面积成反比**)
  - FP,预测错误的空停车角点
  - TG,标注的总的空停车角点
- **阻车器端点**准确率,召回率(指标计算基本同停车角点)

### 2.泊车(后向)
- **停车位**准确率,召回率
- **停车位角点**准确率,召回率

### 3.指标的阈值确定
- **面积**确定,opencv函数
- **面积阈值**,统计不同情况下车位面积大小,确定划分区间
  - 后向分为1W,3W,8W
  - 侧向分为1W,3W
- **遮挡点**,标注数据里根据点状态获取
- **置信度**,按模型预测值确定(暂定0.4,0.6,0.8)
### 7个维度
- 1.有标注的都参与评测(**整体**)
- 2.统计车位面积,统计每一**面积大小**区间内的指标(可以体现重点关注面积和距离的指标,方便操作)
- 3.巡航靠近车身两个角点,泊车四个角点
- 4.按**遮挡点**的维度区分(1个遮挡点指标,2个遮挡点指标等)
- 5.按**置信度**区间统计指标
- 6.按**召回点的距离**平均偏差
- 7.按**召回车位IOU**平均值

### 检测输出结果格式
- 保存成numpy格式,shape为(n,m,9)
- 其中n为图片数,内容为图片在测试集中的偏移
- m为单张图片中的检出的车位数
- 5为(置信度,p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,p4.x,p4.y)
- 利用pickle库序列化和反序列化
- **图片和label对应,json标注文件中的条目和图片顺序一一对应**

## 4. 初版评测结果(后向)
模型448*448,数据从标记数据选出259+flip259共518帧
| 面积 | 遮挡点数 | 点 or 停车位 | 置信度 | precision(%) | recall(%) |
| - | :-: | -: |-: | -: | -: |
|<10000| - |点(20) | 0.4 | 86.54 | 63.42 |
|10000-30000| - |点(20) | 0.4 | 85.05 | 73.50 |
|30000-80000| - |点(20) | 0.4 | 92.35 | 81.77 |
|>80000| - |点(20) | 0.4 | 92.38 | 91.25 |
|<10000| - |park(0.7) | 0.4 | 77.14 | 56.28 |
|10000-30000| - |park(0.7) | 0.4 | 87.26 | 75.00 |
|30000-80000| - |park(0.7) | 0.4 | 100 | 90.83 |
|>80000| - |park(0.7) | 0.4 | 100 | 98.55 |

## 4. 初版评测结果(侧向)
模型448*448,数据从标记数据各场景数据中共1143帧
| 面积 | 遮挡点数 | 点 or 停车位 | 置信度 | precision(%) | recall(%) |
| - | :-: | -: |-: | -: | -: |
|<10000| - |点(20) | 0.4 | 85.32 | 61.66 |
|10000-30000| - |点(20) | 0.4 | 94.00 | 92.37 |
|>30000| - |点(20) | 0.4 | 93.04 | 92.66 |
|<10000| - |停车位(0.7) | 0.4 | 82.41 | 61.21 |
|10000-30000| - |停车位(0.7) | 0.4 | 99.42 | 97.02 |
|>30000| - |停车位(0.7) | 0.4 | 97.82 | 97.82 |

## 后向第二版
模型448*448,数据从标记数据选出共3184帧
| 面积 | 遮挡点数 | 点 or 停车位 | 置信度 | precision(%) | recall(%) |
| - | :-: | -: |-: | -: | -: |
|<10000| - |点(20) | 0.9 | 96.66 | 74.28 |
|10000-30000| - |点(20) | 0.9 | 98.58 | 91.28 |
|30000-80000| - |点(20) | 0.9 | 99.57 | 94.75 |
|>80000| - |点(20) | 0.9 | 99.83 | 98.38 |
|<10000| - |点(10) | 0.9 | 86.89 | 66.04 |
|10000-30000| - |点(10) | 0.9 | 93.29 | 86.11 |
|30000-80000| - |点(10) | 0.9 | 96.40 | 91.19 |
|>80000| - |点(10) | 0.9 | 96.54 | 95.71 |
|<10000| - |park(0.7) | 0.9 | 88.04 | 66.88 |
|10000-30000| - |park(0.7) | 0.9 | 98.52 | 91.37 |
|30000-80000| - |park(0.7) | 0.9 | 99.80 | 94.56 |
|>80000| - |park(0.7) | 0.9 | 100 | 99.35 |

## 侧向第二版
模型448*448,数据从标记数据各场景数据中共1143帧
| 面积 | 遮挡点数 | 点 or 停车位 | 置信度 | precision(%) | recall(%) |
| - | :-: | -: |-: | -: | -: |
|<10000| - |点(10) | 0.9 | 93.50 | 60.30 |
|10000-30000| - |点(10) | 0.9 | 98.12 | 93.40 |
|>30000| - |点(10) | 0.9 | 98.43 | 94.97 |
|<10000| - |点(20) | 0.9 | 93.50 | 60.30 |
|10000-30000| - |点(20) | 0.9 | 98.12 | 93.40 |
|>30000| - |点(20) | 0.9 | 98.43 | 94.97 |
|<10000| - |停车位(0.7) | 0.9 | 95.20 | 60.33 |
|10000-30000| - |停车位(0.7) | 0.9 | 99.62 | 95.28 |
|>30000| - |停车位(0.7) | 0.9 | 1.0 | 97.82 |
